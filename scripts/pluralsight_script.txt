--drop schema if exists
IF OBJECT_ID('Products_Orders', 'U') IS NOT NULL DROP TABLE Products_Orders; 
IF OBJECT_ID('Products', 'U') IS NOT NULL DROP TABLE Products; 
IF OBJECT_ID('Orders', 'U') IS NOT NULL DROP TABLE Orders; 
IF OBJECT_ID('Customers', 'U') IS NOT NULL DROP TABLE Customers; 

--build schema
CREATE TABLE Products
(
  Id INT IDENTITY(1,1),
  Name NVARCHAR(50)

  CONSTRAINT PK_Products PRIMARY KEY CLUSTERED (Id)
)

CREATE TABLE Customers
(
  Id INT IDENTITY(1,1),
  Name NVARCHAR(50)

  CONSTRAINT PK_Customers PRIMARY KEY CLUSTERED (Id)
)

CREATE TABLE Orders
(
  Id INT IDENTITY(1,1),
  CustomerId INT,
  TimeStamp DATETIME DEFAULT GETDATE()

  CONSTRAINT PK_Orders PRIMARY KEY CLUSTERED (Id)
  CONSTRAINT FK_Orders_Customers FOREIGN KEY (CustomerId) REFERENCES Customers(Id)
)

CREATE TABLE Products_Orders
(
  ProductId INT,
  OrderId INT

  CONSTRAINT PK_Products_Orders PRIMARY KEY CLUSTERED (ProductId, OrderId)
  CONSTRAINT FK_PO_Products FOREIGN KEY (ProductId) REFERENCES Products(Id),
  CONSTRAINT FK_PO_Orders FOREIGN KEY (OrderId) REFERENCES Orders(Id)
)

--insert data
INSERT INTO Customers(Name) VALUES ('Dave'), ('Jeff'), ('Mike')
INSERT INTO Products(Name) VALUES ('Coke'), ('Bread'), ('Underwear')
INSERT INTO Orders(CustomerId) VALUES (1), (2)
INSERT INTO Products_Orders(ProductId, OrderId) VALUES (1,1), (2,1), (3,1)
INSERT INTO Products_Orders(ProductId, OrderId) VALUES (1,2), (3,2)

--query
--SELECT * FROM Orders
--SELECT * FROM Products
--SELECT * FROM Products_Orders ORDER BY OrderId
--SELECT * FROM Customers

SELECT Products.Id ProductId, Products.Name, Orders.Id 'OrderId', Orders.TimeStamp, Customers.Name FROM Products
INNER JOIN Products_Orders PO
ON Products.Id = PO.ProductId
INNER JOIN Orders
ON PO.OrderId = Orders.Id
INNER JOIN Customers
ON Orders.CustomerId = Customers.Id
ORDER BY Orders.Id